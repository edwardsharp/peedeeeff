<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>pee-dee-eff tee-stt-trr</title>
        <script src="pee-dee-eff.js"></script>
        <script id="paths-data" type="application/json">
            [
                ["example/undoinganddoing", 6],
                ["geozone/disinformation", 11],
                ["geozone/safer-without-police", 13],
                ["geozone/otay-mountain", 39],
                ["geozone/the-anthropussy", 15],
                ["geozone/whirlwind-i", 17],
                ["geozone/ruptures-i", 20],
                ["geozone/the-anthropussy-print", 7],
                ["geozone/garbage-gardening", 12],
                ["geozone/strangers-print", 7],
                ["geozone/strange-natures-print", 25],
                ["geozone/jesters-freaks", 4],
                ["geozone/zine-education", 31],
                ["geozone/nyc-gentrification", 15],
                ["geozone/ruptures-i-print", 19],
                ["geozone/sounds-birmingham", 35],
                ["geozone/people-ports-power-02", 55],
                ["geozone/strange-natures", 51],
                ["geozone/foraging-art-print", 4],
                ["geozone/crisis-accomodation-print", 9],
                ["geozone/mapping-customary-practices", 67],
                ["geozone/nyc-gentrification-print", 7],
                ["geozone/start-with-a-park-print", 0],
                ["geozone/hiss2025-print-compressed", 15],
                ["geozone/handford", 6],
                ["geozone/body-territories-datafied-city", 19],
                ["geozone/whirlwind-ii", 23],
                ["geozone/esri", 16],
                ["geozone/data-centres", 22],
                ["geozone/the-words-print", 1],
                ["geozone/black-ecologies", 63],
                ["geozone/crisis-accomodation", 10],
                ["geozone/mapping-sense", 7],
                ["geozone/love-and-rage-print", 0],
                ["geozone/villes-de-guerre-quotidienne", 37],
                ["geozone/dumpster-stories-print", 7],
                ["geozone/embodying-pipeline-print", 9],
                ["geozone/energyscapes", 13],
                ["geozone/the-paradise", 95],
                ["geozone/tarde-01", 4],
                ["geozone/mapping-emotions", 79],
                ["geozone/tarde-06", 6],
                ["geozone/memorias-espanol", 35],
                ["geozone/alaskaland", 7],
                ["geozone/theoretical-self-defense", 19],
                ["geozone/heat-diary", 93],
                ["geozone/hiss2025", 16],
                ["geozone/garbage-gardening-print", 11],
                ["geozone/david-goliath", 8],
                ["geozone/the-words", 7],
                ["geozone/strangers", 15],
                ["geozone/zine-education-print", 48],
                ["geozone/mais-dauntaun-1", 95],
                ["geozone/data-centres-print", 23],
                ["geozone/anti-ableist-university", 23],
                ["geozone/embodying-pipeline", 19],
                ["geozone/elc-healthcare", 14],
                ["geozone/abolition-methodologies", 31],
                ["geozone/taming-rivers", 8],
                ["geozone/academic-rebellion-print", 9],
                ["geozone/aukaat", 72],
                ["geozone/treaty-rock", 9],
                ["geozone/defensive-design", 17],
                ["geozone/space-waste", 13],
                ["geozone/transformative-housing-print", 5],
                ["geozone/straights", 12],
                ["geozone/staircase-oskemen", 11],
                ["geozone/anti-ableist-university-alt-text", 8],
                ["geozone/remember-that-girl", 8],
                ["geozone/misoprostol-print", 11],
                ["geozone/people-ports-power-01", 41],
                ["geozone/sounds-wollongong", 67],
                ["geozone/peace-stories", 35],
                ["geozone/abolition-methodologies-print", 15],
                ["geozone/inland-empire-waterways", 7],
                ["geozone/energyscapes-print", 13],
                ["geozone/militarism-climate-crisis", 27],
                ["geozone/recuerda-esa-chica", 8],
                ["geozone/dumpster-stories", 15],
                ["geozone/love-and-rage", 7],
                ["geozone/quercus", 11],
                ["geozone/start-with-a-park", 4],
                ["geozone/misoprostol", 6],
                ["geozone/defensive-design-print", 17],
                ["geozone/academic-rebellion", 18],
                ["geozone/cities-of-banal-warfare", 37],
                ["geozone/myron-eells", 11],
                ["geozone/memorias-english", 35],
                ["geozone/militarism-climate-crisis-print", 27],
                ["geozone/foraging-art", 7],
                ["geozone/jesters-freaks-print", 7],
                ["geozone/got-power", 19],
                ["geozone/love-ctrl", 10],
                ["geozone/living-anarchy", 5],
                ["geozone/mais-dauntaun-3", 103],
                ["geozone/mais-dauntaun-4", 119],
                ["geozone/tarde-05", 2],
                ["geozone/tarde-02", 4],
                ["geozone/gaza-academics", 2],
                ["geozone/come-habla", 34],
                ["geozone/rootling", 6],
                ["geozone/transformative-housing", 11],
                ["geozone/mapping-routes", 43],
                ["geozone/mais-dauntaun-2", 91],
                ["geozone/demand-the-impossible", 25],
                ["geozone/sounds-detroit", 45],
                ["geozone/seabed-mining", 13],
                ["geozone/tarde-03", 4],
                ["geozone/rootling-print", 5],
                ["geozone/tarde-04", 6]
            ]
        </script>
        <style>
            * {
                box-sizing: border-box;
            }
            body {
                margin: 0;
                background: black;
                color: white;
                font-family: sans-serif;
                height: 100dvh;
            }
            main {
                width: 100%;
                height: 100%;
                overflow: auto;
            }
            nav {
                position: absolute;
                top: 3rem;
                right: 0;
                width: 200px;
                max-height: calc(100dvh - 3rem);
                background: black;
                color: white;
                overflow-y: auto;
                display: none;
                flex-direction: column;
                border: thick solid magenta;
            }
            #nav-toggle {
                position: absolute;
                top: 0;
                right: 0;
                background: magenta;
                color: black;
                width: 200px;
                padding: 1rem;
                cursor: pointer;
                font-weight: bold;
                text-align: center;
                transition: opacity 0.4s ease;
            }
            #nav-toggle:hover,
            button:hover,
            input[type="radio"]:hover + label,
            input[type="checkbox"]:hover + label,
            #madewith:hover {
                background: white;
                color: black;
            }
            .tabs {
                display: flex;
                gap: 0rem;
                position: sticky;
                top: 0;
                background: black;
            }
            .tab {
                flex: 1;
                background: black;
                color: white;
                border: none;
                padding: 0.5rem;
                cursor: pointer;
                text-align: center;
            }
            .tab.active {
                background: magenta;
                color: black;
            }
            .panel {
                display: none;
            }
            .panel.active {
                display: block;
                /* padding-bottom: 1rem; */
            }
            button:hover {
                cursor: pointer;
            }
            label {
                display: block;
                margin-top: 1rem;
                font-weight: bold;
            }
            small {
                display: block;
                color: magenta;
                font-size: 0.75rem;
                margin-bottom: 0.25rem;
            }
            input,
            select,
            button {
                width: 100%;
                padding: 0.25rem;
                background: black;
                color: white;
                border: 1px solid white;
            }
            .radio-group {
                display: flex;
                gap: 0.5rem;
                margin-top: 0.25rem;
            }
            .radio-group label {
                font-weight: normal;
                margin: 0;
            }
            output {
                display: block;
                text-align: right;
                color: magenta;
            }
            #path-list {
                list-style: none;
                padding: 0;
                margin: 0;
            }
            #page-range-container {
                display: flex;
                gap: 1rem;
                align-items: center;
            }
            #prop-form {
                padding: 0rem 0.5rem 1rem 0.5rem;
            }
            #madewith {
                position: sticky;
                bottom: 0;
                background: magenta;
                text-align: center;
                padding: 0.25rem 0;
                font-size: smaller;
            }
        </style>
    </head>
    <body>
        <div id="nav-toggle">P E E - D E E - E F F</div>
        <nav id="flyout">
            <div class="tabs">
                <button class="tab active" data-tab="paths">ZINEZ</button>
                <button class="tab" data-tab="props">CONFIG</button>
            </div>
            <div class="panel active" id="panel-paths">
                <ul id="path-list"></ul>
            </div>
            <div class="panel" id="panel-props">
                <form id="prop-form">
                    <label>
                        <pre>direction</pre>
                        <div class="radio-group">
                            <label
                                ><input
                                    type="radio"
                                    name="direction"
                                    value="horizontal"
                                    checked
                                />
                                horizontal</label
                            >
                            <label
                                ><input
                                    type="radio"
                                    name="direction"
                                    value="vertical"
                                />
                                vertical</label
                            >
                        </div>
                        <small>horizontal or vertical layout mode</small>
                    </label>
                    <label>
                        <pre>pages-per-view</pre>
                        <div id="page-range-container">
                            <input
                                type="range"
                                name="pages-per-view"
                                min="1"
                                max="16"
                                value="2"
                                step="1"
                            />
                            <output id="ppv-output">2</output>
                        </div>
                        <small>pagez shown per view (grid layout adaptz)</small>
                    </label>
                    <label>
                        <pre>loop</pre>
                        <input type="checkbox" name="loop" />
                        <small>loop from end to start</small>
                    </label>
                    <label>
                        <pre>1up-first-and-last</pre>
                        <input type="checkbox" name="1up-first-and-last" />
                        <small>show first/last slides 1-up</small>
                    </label>
                    <label>
                        <pre>background</pre>
                        <input type="text" name="background" value="white" />
                        <small>color behind each page</small>
                    </label>
                </form>
            </div>

            <a id="madewith" href="https://github.com/edwardsharp/peedeeeff"
                >madewith ðŸ’– in nyc</a
            >
        </nav>

        <main>
            <pee-dee-eff id="peedeeeff"></pee-dee-eff>
        </main>

        <script>
            window.peedeeeff = document.getElementById("peedeeeff");
            const toggle = document.getElementById("nav-toggle");
            const flyout = document.getElementById("flyout");
            const tabs = document.querySelectorAll(".tab");
            const panels = document.querySelectorAll(".panel");
            const form = document.getElementById("prop-form");
            const ppvSlider = form.querySelector(
                "input[name='pages-per-view']",
            );
            const ppvOutput = document.getElementById("ppv-output");
            const list = document.getElementById("path-list");
            let currentBasePath = null;

            function collectFormProps() {
                const data = new FormData(form);
                const props = currentBasePath
                    ? { "base-path": currentBasePath }
                    : {};
                for (const [key, value] of data.entries()) {
                    if (key === "pages-per-view") props[key] = value;
                    else if (key === "loop" || key === "1up-first-and-last")
                        props[key] = true;
                    else props[key] = value;
                }
                return props;
            }

            function toggleNav() {
                flyout.style.display =
                    flyout.style.display === "flex" ? "none" : "flex";
            }

            toggle.addEventListener("click", toggleNav);

            tabs.forEach((tab) => {
                tab.addEventListener("click", () => {
                    tabs.forEach((t) => t.classList.remove("active"));
                    panels.forEach((p) => p.classList.remove("active"));
                    tab.classList.add("active");
                    document
                        .getElementById("panel-" + tab.dataset.tab)
                        .classList.add("active");
                });
            });

            const zineData = document.getElementById("paths-data")?.textContent;
            if (zineData) {
                const zinez = JSON.parse(zineData);
                const getLastSegment = (str) => {
                    const parts = str.split("/");
                    return parts[parts.length - 1] || str;
                };
                zinez.forEach(([path], index) => {
                    const li = document.createElement("li");
                    const btn = document.createElement("button");
                    btn.textContent = getLastSegment(path);
                    btn.onclick = () => {
                        currentBasePath = path;
                        updateViewer(collectFormProps());
                        toggleNav();
                    };
                    li.appendChild(btn);
                    list.appendChild(li);

                    if (index === 0) {
                        currentBasePath = path;
                        updateViewer(collectFormProps());
                    }
                });
            }

            form.addEventListener("change", () => {
                const props = collectFormProps();
                if (props["base-path"]) updateViewer(props);
            });

            ppvSlider.addEventListener("input", () => {
                ppvOutput.textContent = ppvSlider.value;
            });

            function updateViewer(attrs) {
                const oldEl = window.peedeeeff;
                const newEl = oldEl.cloneNode(true);
                for (const name of oldEl.getAttributeNames()) {
                    newEl.removeAttribute(name);
                }
                for (const key in attrs) {
                    newEl.setAttribute(key, attrs[key]);
                }
                newEl.id = "peedeeeff";
                oldEl.replaceWith(newEl);
                window.peedeeeff = newEl;
            }

            // auto-hide nav toggle after inactivity
            let navTimeout = null;
            const navToggle = document.getElementById("nav-toggle");

            function resetNavVisibility() {
                navToggle.style.opacity = "1";
                navToggle.style.pointerEvents = "auto";
                if (navTimeout) clearTimeout(navTimeout);
                navTimeout = setTimeout(() => {
                    navToggle.style.opacity = "0";
                    navToggle.style.pointerEvents = "none";
                }, 3145);
            }

            document.addEventListener("mousemove", resetNavVisibility);
            document.addEventListener("touchstart", resetNavVisibility);
            resetNavVisibility();
        </script>
    </body>
</html>
